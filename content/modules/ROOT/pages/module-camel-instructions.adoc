= Building a multi-channel support service for Globex customers - Instructions
:imagesdir: ../assets/images
include::../assets/css/site.css

++++
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z54F1ZPC4H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z54F1ZPC4H');
</script>

<style>
  .underline {
    cursor: pointer;
  }

  .nav-container {
    display: none !important;
  }

  .doc {    
    max-width: 70rem !important;
  }

  .pagination .prev {
    display: none !important;
  }
</style>
++++

:icons: font 

// :toc: 
// :sectlinks:

:sectnums:
:experimental:

:camelfolder: /projects/workshop-devspaces/workshop/module-camel/lab

:topologyviewurl: {openshift_cluster_console}/topology/ns/globex-camel-{user_name}?view=graph

:globexweburl: https://globex-web-globex-camel-{user_name}.{openshift_subdomain}/home

:rocketchaturl: https://rocketchat.{openshift_subdomain}

:elementurl: https://element.{openshift_subdomain}

== Quick overview of the lab exercises

{empty} +

The animation below illustrates the 3 main integration systems you will deliver along the module.

++++
<p align="center">
	<img src="./_images/camel/lab-tasks-animation.gif" style="width:90%;border-style: none;">
</p>
++++

{empty} +

You'll notice the architecture above contains 4 Camel applications.

- To simplify the lab, the Rocket.Chat integration is provided and already deployed in the environment. You only need to focus on the applications below.

- As per the animation above:
. The Matrix integration represents the first system to build.
. The Globex integration represents the second one to build.
. The third one to build, persists and shares a transcript.

{empty} +


== Prepare your Development environment
=== Ensure lab readiness

[IMPORTANT]
=====
Before you proceed it is critical that your lab environment is completely ready before executing the lab instructions.
=====

* Access the *Workshop Deployer* browser tab and check if the *Launch new channels using Contract-First approach* has turned green. This indicates that the module has been fully deployed and is ready to use. 

.Module Readiness on Workshop Deployer
image::camel/camel-workshop-deployer.png[width=40%]

=== Setup OpenShift Dev Spaces 

[TIP]
====
If you have open browser tabs from just completing a previous module, please close all but *the Workshop Deployer and this Instructions browser tab* to avoid proliferation of tabs which can make working difficult.
====

To implement the integrations you are going to use OpenShift Dev Spaces. Dev Spaces provides a browser based development environment that includes the lab's project, an editor for coding, and a terminal from where you can test and deploy your work in OpenShift.


++++
<p align="center">
	<img src="./_images/camel/devspaces-workflow.jpg" style="width:90%;border-style: none;">
</p>
++++

OpenShift Dev Spaces uses Kubernetes and containers to provide a consistent, secure, and zero-configuration development environment, accessible from a browser window.

* In a browser window, navigate to the browser tab pointing to the Developer perspective of the OpenShift cluster. If you don't have a browser tab open on the console, navigate to {openshift_cluster_console}[OpenShift Console, window=_console]. If needed login with your username and password ({user_name}/{user_password}).

* On the top menu of the console, click on the image:openshift-application-menu.png[] icon, and in the drop-down box, select *Red Hat OpenShift Dev Spaces*.
+
++++
<img src="./_images/openshift-application-menu-2.png" style="width:100%;border-style: none;">
++++
+
{empty} +

* Login in with your OpenShift credentials ({user_name}/{user_password}). If this is the first time you access Dev Spaces, you have to authorize Dev Spaces to access your account. In the _Authorize Access_ window click on *Allow selected permissions*. 
+
image::devspace-auth-access.png[width=70%]

* You are directed to the Dev Spaces overview page, which shows the workspaces you have access to. You should see a single workspace, called *cloud-architecture-workshop*. The workspace needs a couple of seconds to start up.
+
++++
<img src="./_images/devspaces-workspace-starting.png" style="width:100%;border-style: none;">
++++
+
{empty} +

* Click on the *Open* link of the workspace.
+
++++
<img src="./_images/devspaces-workspace-started-1.png" style="width:100%;border-style: none;">
++++
+
{empty} +


* This opens the workspace, which will look pretty familiar if you are used to work with VS Code. Before opening the workspace, a pop-up might appear asking if you trust the contents of the workspace. Click *Yes, I trust the authors* to continue.
+
++++
<img src="./_images/devspaces-trust-contents.png" style="width:50%;border-style: none;">
++++
+
{empty} +


* The workspace contains all the resources you are going to use during the workshop. In the project explorer on the left of the workspace, navigate to the folder:
- `workshop/module-camel/lab`
+
++++
<img src="./_images/camel/devspaces-project-tree.png" style="width:100%;border-style: none;">
++++
+
{empty} +

* Open the built-in Terminal. Click on the [1] image:devspaces-menu.png[] icon on the top of the left menu, and select [2] *Terminal /* [3] *New Terminal* from the drop-down menu.
+
++++
<img src="./_images/camel/devspaces-open-terminal.png" style="width:40%;border-style: none;">
++++

* This opens a terminal in the bottom half of the workspace.
+
++++
<img src="./_images/camel/devspaces-view-terminal.png" style="width:100%;border-style: none;">
++++
+
{empty} +

* The OpenShift Dev Spaces environment has access to a plethora of command line tools, including *oc*, the OpenShift  command line interface. Through OpenShift Dev Spaces you are automatically logged in into the OpenShift cluster. You can verify this with the command *oc whoami*.
+

[source,bash,role=execute, subs="attributes"]
----
oc whoami
----
+

.Output
[source, subs="attributes"]
----
{user_name}
----
+

[IMPORTANT]
====
If the the output of the `oc whoami` command does not correspond to your username ({user_name}), you need to logout and login again with the correct username.

[source,bash,role=execute, subs="attributes"]
----
oc logout
oc login -u {user_name} -p {user_password} {openshift_api_internal}
----

====

* You will be working in the `globex-camel-{user_name}` namespace. So run this following command to start using that particular project

+
[source,bash,role=execute, subs="attributes"]
----
oc project globex-camel-{user_name}
----
+
.Output
[source,textinfo,subs="attributes"]
----
Now using project "globex-camel-{user_name}" on server "{openshift_api_internal}".
----
+
++++
<img src="./_images/camel/devspaces-login-project.png" style="width:60%;border-style: none;">
++++

{empty} +


