= Event driven applications with Serverless Knative Eventing - Instructions
:imagesdir: ../assets/images

++++
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y0GQBF9YFH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y0GQBF9YFH');
</script>

<style>
  .underline {
    cursor: pointer;
  }

  .nav-container {
    display: none !important;
  }

  .doc {    
    max-width: 70rem !important;
  }

  .pagination .prev {
    display: none !important;
  }
</style>
++++

// :toclevels: 2
:icons: font 
:sectanchors:
:sectnums:
// :toc: 

== Overview of activities

Here is an outline of the activities you will achieve as part of this module.

* Gain understanding of what has been already setup for you
* Deploy the Quarkus Knative Services needed for the solution
* Build an event mesh with OpenShift Serverless Eventing components
* Try out the solution end-to-end to see how data flows through the various systems and services

== Prepare your Development environment
=== Ensure lab readiness

[IMPORTANT]
=====
Before your proceed it is critical that your lab environment is completely ready before executing the lab instructions.
=====

* Access the *Workshop Deployer* browser tab and check if the *Event driven applications with Serverless Knative Eventing* has turned green. This indicates that the module has been fully deployed and is ready to use. 

.Module Readiness on Workshop Deployer
image::serverless/serverless-workshop-deployer.png[width=40%]


== Deployment overview and introduction

. In a browser window, navigate to the {openshift_cluster_console}[OpenShift console, window="console"]. If needed, login with your username and password *({user_name}/{user_password})*. +
If this is the first time you open the console, you will be directed to the Developer Perspective of the console, which shows you the different namespaces you have access to.
+
image::serverless/serverless-openshift-landing.png[]
.. `globex-serverless-{user_name}` namespace contains the components you will be working on in this lab
.. `globex-gitops-{user_name}` namespace contains the ArgoCD elements for GitOps. This is described in detail in the *Introduction* module.
.. `globex-mw-{user_name}` contains Middleware deployments including streams for Apache Kafka
.. `globex-{user_name}` namespace contains other services the application is dependent on. This is described in detail in the *Introduction* module.

. Click on the `globex-serverless-{user_name}` namespace link to select the namespace you are going to use in this lab, and select `Topology` from the left menu.
. The *Topology* view displays the components that have been setup for you already. Note that this screenshot shows the topology after the components have been moved around to be displayed well here.
+
image::serverless/serverless-namespace-initial-toplogy.png[]
. Let us look at a few of the current components. The rest of the components are discussed in the next sections
+
[cols="20%,80%"]
|===
|*Component* | *Function*
| globex-web        | This is a _NodeJS + Angular_ web application which serves as the front end website. This app relies on the core services deployed in the globex-{user_name} namespace and the `product-reviews` services described below
| product-reviews   | This Quarkus based service is a backend for the `globex-web` web application. 
| reviews-db        | Postgresql DB to store the reviews once they are moderated. 
| serverless-kafka-secret | For the purpose of this workshop, this job copies the Kafka credentials (`kafka-secret` Secret) into the current globex-serverless-{user_name} namespace.
|===


=== Red Hat streams for Apache Kafka setup overview 

.  Red Hat Streams based on Apache Kafka has been setup for you already. The Kafka broker is installed in the globex-mw-{user_name} namespace.In the same namespace, streams for Apache Kafka console, a web UI for viewing Kafka topics and browsing consumer groups, is also installed. +
. Click to navigate to https://streams-console-{user_name}.{openshift_subdomain}[streams for Apache Kafka console, window="_amqstreams"]. 
.. This redirects you to the streams for Apache Kafka console login page. 
.. For the purpose of this workshop, choose *Sign in with Anonymous Session* to access the console if you are not already signed in.
. Navigate to the navigate to *Kafka Clusters -> kafka -> Topics*. Notice that there are 3 topics which are relevant to this module (you can filter with the word *reviews*). 
+
image::serverless/amqstreams-console-3topics.png[]
. Here is what each of these topics are meant for:
+
[cols="25%,75%",]
|===
| *Kafka Topic* | *Function*
| globex.reviews     | When a user submits a review, that review is produced to this topic with Knative Eventing framework.
| reviews.moderated  | Reviews which are moderated are produced to this topic to be further persisted in a database.
| reviews.sentiment  | Holds the reviews after analysis with a sentiment score.
|===
